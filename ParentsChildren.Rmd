---
title: 'BA1820: Group Project'
author: "Team 3"
date: ''
output:
  pdf_document: default
  html_document: default
---

```{r, echo = TRUE}

#Relationship between parents and children (Kelvin/Bilal)

# ==========================
# Kelvin's beta code (START)
# ==========================

# Load globally cleaned data file
load("cleaned_data.Rdata")
# the data frame variable, survey_data, will be loaded into the environment.

# load needed libraries
library(ggplot2)
library(stargazer)

# ---------------------
# Data cleaning methodology
# ---------------------

# Even with the global cleaning of data,
# we'll need to further clean the dataset on a 'local' basis
# i.e. based on the specific questions we are studying,
# we will need to go through those questions' columns of data,
# and check that the responses are in the valid range.
# if not, fill them with NAs

# ---------------------
# Study on correlations
# ---------------------

# ---------------------
# Question 1
# ---------------------
# 1.	Relationship between parents who are strict with their children and the teen’s usage of social media (could look at differentiation between male and female children)
#   	Hypothesis: The stricter the parent, the more time teen will use social media.

# Study correlation between these two:
  
#  P4:         Which comes closer to the way you approach the time your child spends with his/her friends?  1.          He/She can spend as much time with his/her friends as he/she wants as long as it doesn’t interfere with other pre-planned activities,2.               I limit the time he/she spends with his/her friends, even if it doesn’t interfere with other pre-planned activities.
# [66% response rate]

#  KFR11_H: How often do you spend time with friends  posting on social media sites? 1.Every day,2.Every few days,3. Less often,4. Never
# [48% response rate]

# Local data cleaning:
# Do not remove rows but fill them with NAs instead.
# So that you can add on columns more easily
# for a more disaggregated / detailed analysis.
# Otherwise, if we had deleted invalid rows from the dataset,
# when you want to add another column in, the number of rows
# would not match. Removing NAs will be easier.
# e.g. when data_specific$parent_control_time is NA, set data_specific$y NA too
# and when performing functions, use na.rm (lm for example, by default, uses na.omit)

# create a copy of the 'global' dataset survey_data
# into a variable data_specific. Use this local variable
# for further data manipulation rather than editing the
# survey_data variable. If we edit survey_data directly
# we may mess up the dataset that other team members may use 
# in their code, once we have combined our code altogether.
data_specific <- data.frame(parent_control_time = survey_data$P4, y = survey_data$KFR11_H)

# set NA to invalid responses, 
# e.g. parent_control_time (question P4), should have 1 and 2 as valid responses.
data_specific[ is.na(data_specific$parent_control_time), ] <- NA
data_specific[ is.na(data_specific$y), ] <- NA
data_specific[ !is.na(data_specific$parent_control_time) & (data_specific$parent_control_time < 1 | data_specific$parent_control_time > 2), ] <- NA  # needs the !is.na condition otherwise an error throws up
data_specific[ !is.na(data_specific$y) & (data_specific$y < 1 | data_specific$y > 4), ] <- NA  # needs the !is.na condition otherwise an error throws up


# Change the order of answers, from 1 for 'most' to 1 for 'least'
# To illustrate:
# The choices for each question are numbered.
# For P4,
#   1. He/She can spend as much time with his/her friends as he/she wants as long as it doesn’t interfere with other pre-planned activities
#   2. I limit the time he/she spends with his/her friends, even if it doesn’t interfere with other pre-planned activities.
# Here, 1 is the 'most' because child can spend as much time, 2 is 'least'
# but if we were to do regression, we should flip the order
# 1 should be 'least' and 2 should be 'most'.
# Same for question KFR11_H

data_specific$parent_control_time <- abs( data_specific$parent_control_time - 3 )
data_specific$y <- abs( data_specific$y - 5 )

cor.test(data_specific$parent_control_time, data_specific$y)
# TO DO: change these cat commands into text in Rmd file.
cat('p-value = 0.01889')
cat('As p-value is less than 5%, we have 95% confidence to reject H0')
cat('where H0 is that correlation is 0')
cat('It has a positive correlation of 0.0843738.')
cat('The stricter the parent, the more time child spends on social media')

# Plot a boxplot for each option in parent_control_time, just to visualise it
ggplot(data = na.omit(data_specific)) + geom_boxplot(aes(x=factor(parent_control_time), y=y)) + xlab("Parent's strictness") + scale_x_discrete(labels = c("1" = "Allow as much time", "2" = "Limit the time")) + ylab("Teen's time spent on social media") + scale_y_continuous(labels = c("1" = "Never", "2" = "Less often", "3" = "Every few days", "4" = "Every day")) + theme(axis.text.y = element_text(size=5))

# See if there are differences in gender
data_specific[, "gender"] <- survey_data$Child_gender
# Correlation of x and y, given males. Male = option 1
cor.test(data_specific[data_specific[,"gender"] == 1, "parent_control_time"], data_specific[data_specific[,"gender"] == 1, "y"])
cat('p-value = 0.3823 for Males')
# Correlation of x and y, given males. Female = option 2
cor.test(data_specific[data_specific[,"gender"] == 2, "parent_control_time"], data_specific[data_specific[,"gender"] == 2, "y"])
cat('p-value = 0.006259 for Females')
cat('Correlation coefficient = 0.1348115')

data_specific$gender <- factor(data_specific$gender, labels = c("Male","Female"))
ggplot(data = na.omit(data_specific)) + geom_boxplot(aes(x = factor(parent_control_time), y = y, color = gender)) + xlab("Parent's strictness") + scale_x_discrete(labels = c("1" = "Allow as much time", "2" = "Limit the time")) + ylab("Teen's time spent on social media") + scale_y_continuous(labels = c("1" = "Never", "2" = "Less often", "3" = "Every few days", "4" = "Every day")) + theme(axis.text.y = element_text(size=5))

cat('This seems to suggest that female teens may be more rebellious than male teens.')
cat('In that their time spent on social media positively correlates with how strict their parents are')
cat('Whereas male teens do not correlate well')

# Besides question P4, there is another question that 
# may also be indicative of parent's strictness
# It is P13_A.
# Let's add this data (and clean it) into the local data set
# and run a regression to study the significance
# of P4 and P13_A relating to the dependent variable qn KFR11_H (teen's time on social media)

# P13_A:          Have you ever used parental controls or other technological means of blocking, filtering or monitoring your child's online activities?  1(YES)-2(NO)-3(does Not Apply)
data_specific[, "parent_block_online"] <- survey_data$P13_A
# data clean for new question
data_specific[ is.na(data_specific$parent_block_online), ] <- NA
data_specific[ !is.na(data_specific$parent_block_online) & (data_specific$parent_block_online < 1 | data_specific$parent_block_online > 3), ] <- NA  

# convert from 1(YES)-2(NO)-3(does Not Apply)
#           to 0(does Not Apply)-1(NO)-2(YES)
data_specific$parent_block_online <- abs(data_specific$parent_block_online - 4) - 1

cor.test(data_specific$parent_block_online, data_specific$y)
cat('There is no significant evidence to reject H0 hypothesis that correlation between the two variables is 0')
cat('This seems to suggest that whether or not a parent tries to block, filter or monitor their child\'s online activities, has an impact on the time that the child spends on social media')

# convert the independent categorical variables into factors
data_specific$parent_control_time <- factor(data_specific$parent_control_time)
data_specific$parent_block_online <- factor(data_specific$parent_block_online)

# Add age, to see if the teen's age has effect on the time he/her spends on social media
data_specific$age <- survey_data$Child_age

ml <- lm(y ~ parent_control_time + parent_block_online + age, data = na.omit(data_specific))
summary(ml)
cat('the coefficients for parent_control and parent_block_online are significant at 95% confidence level')
cat('whereas the age coefficient is not statistically significant')
cat("However, the coefficients are POSITIVE")
cat("This suggests that the stricter the parent, the more time the teen will spend on social media")

data_specific_male <- data_specific[data_specific$gender == "Male", ]
ml_male <- lm(y ~ parent_control_time + parent_block_online + age, data = na.omit(data_specific_male))
summary(ml_male)
data_specific_female <- data_specific[data_specific$gender == "Female", ]
ml_female <- lm(y ~ parent_control_time + parent_block_online + age, data = na.omit(data_specific_female))
summary(ml_female)
stargazer(list(ml_male, ml_female), type = "text", digits = 2)
cat('Parents who block their teen child seems to increase teen\'s usage by 1 choice upwards')

# ---------------------
# Question 2
# ---------------------
#	Relationship between parents blocking their child’s phone usage and their child’s online behaviour on sexy/flirty pictures
# a.	Hypothesis: The stricter the parent, the more the child wants to be liberal.

data_specific <- data.frame(parent_controls_cell_phone = survey_data$P14_F, take_away_privileges = survey_data$P13_D, limit_time_online = survey_data$P13_E, y = survey_data$KDATE2_G)

# set NA to invalid responses
data_specific[ is.na(data_specific$parent_controls_cell_phone), ] <- NA
data_specific[ is.na(data_specific$take_away_privileges), ] <- NA
data_specific[ is.na(data_specific$limit_time_online), ] <- NA
data_specific[ is.na(data_specific$y), ] <- NA
data_specific[ !is.na(data_specific$parent_controls_cell_phone) & (data_specific$parent_control_time < 1 | data_specific$parent_control_time > 3), ] <- NA  # needs the !is.na condition otherwise an error throws up
data_specific[ !is.na(data_specific$take_away_privileges) & (data_specific$parent_control_time < 1 | data_specific$parent_control_time > 3), ] <- NA  # needs the !is.na condition otherwise an error throws up
data_specific[ !is.na(data_specific$limit_time_online) & (data_specific$parent_control_time < 1 | data_specific$parent_control_time > 3), ] <- NA  # needs the !is.na condition otherwise an error throws up
data_specific[ !is.na(data_specific$y) & (data_specific$y < 1 | data_specific$y > 2), ] <- NA  # needs the !is.na condition otherwise an error throws up

# convert from 1(YES)-2(NO)-3(does Not Apply)
#           to 0(does Not Apply)-1(NO)-2(YES)
data_specific$parent_controls_cell_phone <- abs(data_specific$parent_controls_cell_phone - 4) - 1
data_specific$take_away_privileges <- abs(data_specific$take_away_privileges - 4) - 1
data_specific$limit_time_online <- abs(data_specific$limit_time_online - 4) - 1
# convert from 1(YES)-2(NO)
#           to 1(NO)-2(YES)
data_specific$y <- abs( data_specific$y - 3 )

# convert to factor for linear regression
data_specific$parent_controls_cell_phone <- factor(data_specific$take_away_privileges)
data_specific$take_away_privileges <- factor(data_specific$take_away_privileges)
data_specific$limit_time_online <- factor(data_specific$limit_time_online)

data_specific$age <- survey_data$Child_age

ml <- lm(y ~ parent_controls_cell_phone + take_away_privileges + limit_time_online + age, data = na.omit(data_specific))
summary(ml)
cat('only age is statistically significant')
cat('get NA for take_away_privileges.. why? perhaps insufficient data after all the other indpenedent variables are added?')



# ==========================
# Kelvin's beta code (END)
# ==========================

```

